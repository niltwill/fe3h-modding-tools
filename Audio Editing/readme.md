### Basic knowledge of the audio filesThere are two file formats that contain audio:1. ktsl2asbin - but note that not all of these files contain voice files encoded with the GCADPCM codec. These are usually battle quotes. They can also be special effects (noises) or other sound effects, so they are not necessarily character-related. These files can be changed standalone (on their own). Some of these files are collections, which contain multiple KTSR files (ktsl2asbin files) in one big file (such as 30831-30837, 31001-31007).2. ktsl2stbin - these files contain KTSS audio files, which can be easily extracted. They have a matching ktsl2asbin file as well, which need to be edited too, if the ktsl2stbin file changes, due to the link ID and new or changed audio data - so you have to be aware of this.The ktsl2stbin files can be simply accessed just by extracting the game's ROMFS, without having to extract the DATA0.bin and DATA1.bin files.These files are located in these directories:- romfs/nx/sound/*.ktsl2stbin- romfs/nx/sound/Resource_EN/*.ktsl2stbin- romfs/patch4/nx/sound/PATCH_SND.ktsl2stbin- romfs/patch4/nx/sound/Resource_EN/PATCH_SND_EN.ktsl2stbin## Linked filesThe Japanese audio (9 files) can be found in this folder: `romfs/nx/sound` - *BGM*		--> 30829.ktsl2asbin (nx/sound/se_ktsl2) - EV		--> 30831.ktsl2asbin (nx/sound/se_ktsl2) - LO		--> 30834.ktsl2asbin (nx/sound/se_ktsl2) - *MOV*		--> 30830.ktsl2asbin (nx/sound/se_ktsl2) - NR		--> 30833.ktsl2asbin (nx/sound/se_ktsl2) - SC		--> 30835.ktsl2asbin (nx/sound/se_ktsl2) - SE		--> 30832.ktsl2asbin (nx/sound/se_ktsl2) - SV		--> 30836.ktsl2asbin (nx/sound/se_ktsl2) - TR		--> 30837.ktsl2asbin (nx/sound/se_ktsl2)* These are not in a collection file, easier to edit.The English audio (8 files) can be found here: `romfs/nx/sound/Resource_EN` - EV_EN	--> 31001.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - LO_EN	--> 31004.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - *MOV_EN*	--> 31000.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - NR_EN	--> 31003.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SC_EN	--> 31005.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SE_EN	--> 31002.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SV_EN	--> 31006.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - TR_EN	--> 31007.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2)`BGM`, `MOV` and `MOV_EN` are not in a collection file, so they are much easier to edit.The `BGM` file is only in one place. The file linked next to them show which is their ktsl2asbin counterpart and also the folder where they can be found (after extracted).### Extras:From patch4: - PATCH_SND.ktsl2stbin		--> patch4\nx\sound\se_ktsl2\PATCH_SND.ktsl2asbin.gz - PATCH_SND_EN.ktsl2stbin	--> patch4\nx\sound\Resource_EN\se_ktsl2\PATCH_SND_EN.ktsl2asbin.gzFor compression/decompression of these ".gz" files, you can use "THAT" app in the repo.The romfs of a DLC also has "BGM_DLC.ktsl2stbin" and "BGM_DLC_EN.ktsl2stbin". - BGM_DLC	--> 743.bin (from DLC's DATA0.bin and DATA1.bin) - BGM_DLC_EN	--> 744.bin (from DLC's DATA0.bin and DATA1.bin)For easier work, you should rename "743.bin" to "BGM_DLC.ktsl2asbin" and "744.bin" to "BGM_DLC_EN.ktsl2asbin"### Converting your audio filesThe first step is to convert your audio files to the file format that either the ktsl2sbin or ktsl2atbin needs.Use the included VGAudioCli.exe to do the conversions. End result is that you either get a KTSS or a DSP file.For this, your audio file must be in 48000 Hz (44100 Hz is not accepted!) and in WAV format, or the conversion is not going to work! (You might also try OGG, which could work, I did not test that.)For conversion, it depends on what you replace:1. For ktsl2sbin BGM files, use a higher bit rate for conversion, it should be at around 203 kbps to match the rest of the files:`VGAudioCli -i input.wav -o output.ktss --cbr --bitrate "185000" --opusheader ktss`Loop info should also be added, if required. After you got the KTSS file, you can use the super simple "ktss-loop.py" file to add the loop start and loop length (these values are in samples):`ktss-loop.py input.ktss 12345 678910`First is the input filename, then the loop start, and the last parameter is the loop length. Then check if the loop data exists with "ktss-info.py"2. For voice lines in the ktsl2sbin files, the audio is best to be in mono (1 channel), at bitrate 59 kbps, so something like this:`VGAudioCli -i input.wav -o output.ktss --cbr --bitrate "45000" --opusheader ktss`"SV_EN" may have varying bitrates from 59-62 or so, but in general, most of them are in 59 kbps.To convert the KTSS file to WAV:`VGAudioCli.exe input.ktss output.wav`3. For KTGCADPCM files in ktsl2asbin files, you can use this command to convert a WAV to DSP:`VGAudioCli.exe input.wav output.dsp --out-format gcadpcm`To convert a DSP to WAV:`VGAudioCli.exe input.dsp output.wav`In this case, it's important to note that your WAV file must have a sample count that is divisible by 8 (i.e. you get a whole number as a result after the division)! Otherwise it's going to crackle or pop (not what you want) as long as it's in the DSP (and thus the GCADPCM) format. If you manually edited the audio file, this issue may arise. If necessary, you can just pad out the audio file with empty silence a bit at the end or cut some from the silent samples (either at the beginning or the end). For convenience, you can simply use the tool "pad-wav.py" to correct this issue before converting it to DSP. Please note that this script requires `ffmpeg`: if you don't have the ffmpeg executable in a folder somewhere in your system path, put its binary next to the script.### HOWTO: Modding ktsl2asbinFirst, extract the KTGCADPCM files (will have the extension .vgmstream) from the ktsl2asbin file, using:`python ktsl2asbin-dump.py file.ktsl2asbin`As a bonus, this also creates a .txt file which can be edited and then you can use this script to patch the same file:`python ktsl2asbin-patch.py <info2_dump.txt> <input.ktsl2asbin> [index]`If index number is not specified, it will apply to every entry. This is not that useful though, the text file is there mainly to make information searchable, e.g. Link IDs. Back to topic, you should now have a folder that contains all the audio entries of the ktsl2asbin file. If you want to listen to one of these, you can either use VGMStream with the included ".txth" file (after you put one of the .vgmstream file into the VGMStream directory), or convert it to DSP using this script:`python KTGCADPCM-to-DSP.py XXX.vgmstream [c]`Note that there is an optional flag at the third parameter, a sole "c" letter, which should only be specified with user generated (custom) audio files (to make them playable), but when handling the game's files, don't include it. This is not important if you convert the DSP to a different audio format (WAV, MP3, OGG...) afterward, but if you wish to keep it as DSP and listen to it with Foobar2000 (using the VGMStream plugin), the flag needs the correct value set here, or it's not going to be a valid file (and thus, not playable).The next step is to replace one of these KTGCADPCM files. For that, first convert your audio file (3. section) from the earlier section, if you did not do so yet.Once you have a DSP file:`python DSP-to-KTGCADPCM.py <XXX.dsp> <XXX.vgmstream>`The final step is to use this script and replace an index (for reference, see the numeric filenames in the extracted folder):`python ktsl2asbin-replace.py XXXX.ktsl2asbin XXXX.vgmstream <index>`For checking these files, you can use these scripts: - ktsl2asbin-info.py - dsp-info.py - KTGCADPCM-info.py### HOWTO: Modding ktsl2stbinAs before, the very first thing to do is to extract all the KTSS audio files using this script:`python extract-ktsl2stbin.py <file_path>`Make sure you have your KTSS audio file ready for replacement, if not, do the audio conversion as mentioned in an earlier section (1. or 2.)This is going to be a lot easier, since it's all handled in one script, so simply use that:`python ktsl2stbin-replace.py XXXX.ktsl2stbin XXXX.ktss <index> XXXX.ktsl2asbin`First specify the ktsl2stbin file you wish to edit, then the new KTSS audio file that you want to use, then the index number (which one you wish to replace, see numeric filenames in extracted dir), and finally also the linked ktsl2asbin file (which is connected to the ktsl2sbin file itself). Do not be alarmed if nothing happens, as this may take a while (due to large filesizes).Currently, this only supports editing the audio information in the following ktsl2asbin files (as these are not collections): - BGM - MOV - MOV_EN - BGM_DLC - BGM_DLC_ENThe rest are in containers (such as EV or EV_EN).Extra scripts for information: - ktsl2stbin-info.py - ktss-info.py### ktsl2asbin containers (KTSC)As for collection files or containers (such as 30831-30837, 31001-31007), they are not yet supported for modding. For now, you can use the "extract-ktsr.py" tool to get every ktsl2asbin file from them (the extracted files should match the number of extracted KTSS audio files from the related ktsl2stbin file). As well as the "ktsc-info.py" for more info. Here you can see that they are incrementing based on the Link ID's number.So when building a tool to handle this, one has to seek every Link ID and match it to the equivalent entry in the ktsl2stbin file. Why? Because what's the first entry here in number will not match the first KTSS entry from the ktsl2sbin file. This is required to know which KTSR you need to edit for which audio.After replacing a KTSS audio in the ktsl2stbin file linked to one of these containers, the relevant KTSR also needs changing here, and also every other KTSS offset that comes after it. Since there are numerous entries, doing this by hand (manually) would be definitely unmanageable and unfeasible.### Mapped audioThis can help you to navigate to the relevant sections, depending on what you need to access.* EV_EN.ktsl2stbin | EV = Event (I guess most of these play only during the cutscenes, and not while in free roam?)- Edelgard: 1-800- Dimitri: 801-1728- Claude: 1729-2824?- Hubert: 2825?-3123- Ferdinand: 3124-3218- Linhardt: 3219-3305- Caspar: 3306-3395- Bernadetta: 3396-3490?- Dorothea: 3491?-3538?- Petra: 3539?-3659- Dedue: 3660-3773- Felix: 3774-3859- Ashe: 3860-3909- Sylvain: 3910-4020- Mercedes: 4021-4091- Annette: 4092-4169- Ingrid: 4170-4236- Lorenz: 4237-4361- Raphael: 4362-4421- Ignatz: 4422-4493- Lysithea: 4494-4582- Marianne: 4583-4658?- Hilda: 4659?-4868?- Leonie: 4869?-4954- Seteth: 4955-5534- Flayn: 5535-5650- Hanneman: 5651-5739- Manuela: 5740-5822- Gilbert: 5823-6107- Alois: 6108-6193- Catherine: 6194-6293?- Shamir: 6294?-6346- Cyril: 6347-6393- Jeralt: 6394-6518- Rhea: 6519-6927- Sothis: 6928-7182- Solon: 7183-7190- Thales: 7191-7203- Cornelia: 7204-7224- Death Knight: 7225-7246- Kostas: 7247-7252- Randolph: 7253-7267- Flame Emperor: 7268-7305- Rodrigue: 7306-7477- Judith: 7478-7589- Nardel: 7590-7606- Monica: 7607-7611- Lord Arundel: 7612-7648- Tomas: 7649-7657- Hegemon E.: 7658-7659- Various other characters (like soldiers and the like, those who likely only appear for a couple of voice lines or less): 7660-7938I will expand on to other ktsl2stbin files, I didn't have much time to do this part.