## Basic knowledge of the audio filesThere are two file formats that contain audio:1. **ktsl2asbin** - but note that not all of these files contain voice files encoded with the GCADPCM codec. These are usually battle quotes. They can also be special effects (noises) or other sound effects, so they are not necessarily character-related. These files can be changed standalone (on their own). Some of these files are collections, which contain multiple KTSR files (ktsl2asbin files) in one big file (such as 30831-30837, 31001-31007).2. **ktsl2stbin** - these files contain KTSS audio files, which can be easily extracted. They have a matching ktsl2asbin file as well, which need to be edited too, if the ktsl2stbin file changes, due to the link ID and new or changed audio data - so you have to be aware of this.The ktsl2stbin files can be simply accessed just by extracting the game's ROMFS, without having to extract the DATA0.bin and DATA1.bin files.These files are located in these directories:- romfs/nx/sound/*.ktsl2stbin- romfs/nx/sound/Resource_EN/*.ktsl2stbin- romfs/patch4/nx/sound/PATCH_SND.ktsl2stbin- romfs/patch4/nx/sound/Resource_EN/PATCH_SND_EN.ktsl2stbin## Linked filesThe Japanese audio (9 files) can be found in this folder: `romfs/nx/sound` - BGM.ktsl2stbin		→ 30829.ktsl2asbin (nx/sound/se_ktsl2) - EV.ktsl2stbin		→ 30831.ktsl2asbin (nx/sound/se_ktsl2) - LO.ktsl2stbin		→ 30834.ktsl2asbin (nx/sound/se_ktsl2) - MOV.ktsl2stbin		→ 30830.ktsl2asbin (nx/sound/se_ktsl2) - NR.ktsl2stbin		→ 30833.ktsl2asbin (nx/sound/se_ktsl2) - SC.ktsl2stbin		→ 30835.ktsl2asbin (nx/sound/se_ktsl2) - SE.ktsl2stbin		→ 30832.ktsl2asbin (nx/sound/se_ktsl2) - SV.ktsl2stbin		→ 30836.ktsl2asbin (nx/sound/se_ktsl2) - TR.ktsl2stbin		→ 30837.ktsl2asbin (nx/sound/se_ktsl2)The English audio (8 files) can be found here: `romfs/nx/sound/Resource_EN` - EV_EN.ktsl2stbin		→ 31001.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - LO_EN.ktsl2stbin		→ 31004.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - MOV_EN.ktsl2stbin	→ 31000.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - NR_EN.ktsl2stbin		→ 31003.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SC_EN.ktsl2stbin		→ 31005.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SE_EN.ktsl2stbin		→ 31002.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - SV_EN.ktsl2stbin		→ 31006.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2) - TR_EN.ktsl2stbin		→ 31007.ktsl2asbin (nx/sound/RESOURCE_EN/se_ktsl2)`BGM`, `MOV` and `MOV_EN` are not in a collection file, so they are much easier to edit.The `BGM` file is only in one place. The file linked next to them show which is their ktsl2asbin counterpart and also the folder where they can be found (after extracted).### ExtrasFrom patch4: - PATCH_SND.ktsl2stbin		→ patch4\nx\sound\se_ktsl2\PATCH_SND.ktsl2asbin.gz - PATCH_SND_EN.ktsl2stbin	→ patch4\nx\sound\Resource_EN\se_ktsl2\PATCH_SND_EN.ktsl2asbin.gzFor compression/decompression of these ".gz" files, you can use "THAT" app in the repo.The romfs of a DLC also has "BGM_DLC.ktsl2stbin" and "BGM_DLC_EN.ktsl2stbin": - BGM_DLC.ktsl2stbin		→ 743.bin (from DLC's DATA0.bin and DATA1.bin) - BGM_DLC_EN.ktsl2stbin	→ 744.bin (from DLC's DATA0.bin and DATA1.bin)For easier work, you should rename "743.bin" to "BGM_DLC.ktsl2asbin" and "744.bin" to "BGM_DLC_EN.ktsl2asbin"## Converting your audio filesThe first step is to convert your audio files to the file format that either the ktsl2stbin or ktsl2asbin needs.Use the included `VGAudioCli.exe` (see: `VGAudio` app on this repo) to do the conversions. End result is that you either get a KTSS or a DSP file.For this, your audio file must be in 48000 Hz (44100 Hz is not accepted!) and in WAV format, or the conversion is not going to work! (You might also try OGG, which could work, I did not test that.)For conversion, it depends on what you replace:1. For ktsl2stbin BGM files, use a higher bit rate for conversion, it should be at around 203 kbps to match the rest of the files:\`VGAudioCli -i input.wav -o output.ktss --cbr --bitrate "185000" --opusheader ktss`Loop info should also be added, if required. After you got the KTSS file, you can use the super simple "ktss-loop.py" file to add or edit the loop start and loop length (these values are in samples):\`ktss-loop.py input.ktss 12345 678910`First is the input filename, then the loop start, and the last parameter is the loop length. This is super rudimentary, so do not expect error checks or support for multiple KTSS sections here. Then check if the loop data exists with "ktss-info.py"2. For voice lines in the ktsl2stbin files, the audio is best to be in mono (1 channel), at bitrate 59 kbps, so something like this:\`VGAudioCli -i input.wav -o output.ktss --cbr --bitrate "45000" --opusheader ktss`"SV_EN" may have varying bitrates from 59-62 or so, but in general, most of them are in 59 kbps.3. For KTGCADPCM files in ktsl2asbin files, you can use this command to convert a WAV to DSP:\`VGAudioCli.exe input.wav output.dsp --out-format gcadpcm`In this case, it's important to note that your WAV file must have a sample count that is divisible by 8 (i.e. you get a whole number as a result after the division)! Otherwise it's going to crackle or pop (not what you want) as long as it's in the DSP (and thus the GCADPCM) format. If you manually edited the audio file, this issue may arise. If necessary, you can just pad out the audio file with empty silence a bit at the end or cut some from the silent samples (either at the beginning or the end). For convenience, you can simply use the tool "pad-wav.py" to correct this issue before converting it to DSP. Please note that this script requires `ffmpeg`: if you don't have the ffmpeg executable in a folder somewhere in your system path, put its binary next to the script.It's also rather easy to convert these files back, if you'd like, for example...To convert the KTSS file to WAV:\`VGAudioCli.exe input.ktss output.wav`To convert a DSP to WAV:\`VGAudioCli.exe input.dsp output.wav`## HOWTO: Modding ktsl2asbinFirst, extract the KTGCADPCM files (will have the extension .vgmstream) from the ktsl2asbin file, using:\`python ktsl2asbin-dump.py file.ktsl2asbin`As a bonus, this also creates a .txt file which can be edited and then you can use this script to patch the same file:\`python ktsl2asbin-patch.py <info2_dump.txt> <input.ktsl2asbin> [index]`If index number is not specified, it will apply to every entry. This is not that useful though, the text file is there mainly to make information searchable, e.g. Link IDs. Back to topic, you should now have a folder that contains all the audio entries of the ktsl2asbin file. If you want to listen to one of these, you can either use VGMStream with the included ".txth" file (after you put one of the .vgmstream file into the VGMStream directory), or convert it to DSP using this script:\`python KTGCADPCM-to-DSP.py XXX.vgmstream [c]`Note that there is an optional flag at the third parameter, a sole "c" letter, which should only be specified with user generated (custom) audio files (to make them playable), but when handling the game's files, don't include it. This is not important if you convert the DSP to a different audio format (WAV, MP3, OGG...) afterward, but if you wish to keep it as DSP and listen to it with Foobar2000 (using the VGMStream plugin), the flag needs the correct value set here, or it's not going to be a valid file (and thus, not playable).The next step is to replace one of these KTGCADPCM files. For that, first convert your audio file (3. section) from the earlier section, if you did not do so yet.Once you have a DSP file:\`python DSP-to-KTGCADPCM.py <XXX.dsp> <XXX.vgmstream>`The final step is to use this script and replace an index (for reference, see the numeric filenames in the extracted folder):\`python ktsl2asbin-replace.py XXXX.ktsl2asbin XXXX.vgmstream <index>`For checking these files, you can use these scripts: - ktsl2asbin-info.py - dsp-info.py - KTGCADPCM-info.py## HOWTO: Modding ktsl2stbinAs before, the very first thing to do is to extract all the KTSS audio files using this script:\`python extract-ktsl2stbin.py <file_path>`Make sure you have your KTSS audio file ready for replacement, if not, do the audio conversion as mentioned in an earlier section (1. or 2.)This is going to be a lot easier, since it's all handled in one script, so simply use that:\`python ktsl2stbin-replace.py XXXX.ktsl2stbin XXXX.ktss <index> XXXX.ktsl2asbin`First specify the ktsl2stbin file you wish to edit, then the new KTSS audio file that you want to use, then the index number (which one you wish to replace, see numeric filenames in extracted dir), and finally also the linked ktsl2asbin file (which is connected to the ktsl2stbin file itself). This process may take a while, be patient (due to large filesizes). This script supports both the "regular ktsl2asbin" and the "container ktsl2asbin" (KTSC) files. Note that with the KTSC files, the index you use for replacement will likely be in an entirely different position in the ktsl2asbin file.Extra scripts for information: - extract-ktsr.py (for KTSC) - ktsl2stbin-info.py - ktsc-info.py (for KTSC) - ktss-info.py## Mapped audioThis can help you to navigate to the relevant sections, depending on what you need to access.### BGM.ktsl2stbinMusic tracks. This may get mapped out later.### EV_EN.ktsl2stbinEV = Event (these play only during the cutscenes/events)- Edelgard: 1-800- Dimitri: 801-1728- Claude: 1729-2824?- Hubert: 2825?-3123- Ferdinand: 3124-3218- Linhardt: 3219-3305- Caspar: 3306-3395- Bernadetta: 3396-3490?- Dorothea: 3491?-3538?- Petra: 3539?-3659- Dedue: 3660-3773- Felix: 3774-3859- Ashe: 3860-3909- Sylvain: 3910-4020- Mercedes: 4021-4091- Annette: 4092-4169- Ingrid: 4170-4236- Lorenz: 4237-4361- Raphael: 4362-4421- Ignatz: 4422-4493- Lysithea: 4494-4582- Marianne: 4583-4658?- Hilda: 4659?-4868?- Leonie: 4869?-4954- Seteth: 4955-5534- Flayn: 5535-5650- Hanneman: 5651-5739- Manuela: 5740-5822- Gilbert: 5823-6107- Alois: 6108-6193- Catherine: 6194-6293?- Shamir: 6294?-6346- Cyril: 6347-6393- Jeralt: 6394-6518- Rhea: 6519-6927- Sothis: 6928-7182- Solon: 7183-7190- Thales: 7191-7203- Cornelia: 7204-7224- Death Knight: 7225-7246- Kostas: 7247-7252- Randolph: 7253-7267- Flame Emperor: 7268-7305- Rodrigue: 7306-7477- Judith: 7478-7589- Nardel: 7590-7606- Monica: 7607-7611- Lord Arundel: 7612-7648- Tomas: 7649-7657- Hegemon E.: 7658-7659- Various other characters (like soldiers and the like, those who likely only appear for a couple of voice lines or less): 7660-7938### LO_EN.ktsl2stbinGeneral conversations and lore-related (explaining) or exploration voice lines, such as introductions, recruitment...- Edelgard: 1-110- Dimitri: 111-215- Claude: 216-338- Hubert: 339-418- Ferdinand: 419-578?- Linhardt: 579?-725- Caspar: 726-886- Bernadetta: 887-1028- Dorothea: 1029-1185?- Petra: 1186?-1321- Dedue: 1322-1399- Felix: 1400-1564- Ashe: 1565-1728- Sylvain: 1729-1910- Mercedes: 1911-2068- Annette: 2069-2247- Ingrid: 2248-2429- Lorenz: 2430-2601- Raphael: 2602-2746- Ignatz: 2747-2903- Lysithea: 2904-3089- Marianne: 3090-3240- Hilda: 3241-3397- Leonie: 3998-3554- Seteth: 3555-3666- Flayn: 3667-3780- Hanneman: 3781-3924- Manuela: 3925-4061- Gilbert: 4062-4135- Alois: 4136-4278- Catherine: 4279-4395- Shamir: 4396-4523- Cyril: 4524-4622- Jeralt: 4623-4673- Rhea: 4674-4737- Sothis: 4738-4778- Randolph: 4779-4796- Jeritza: 4797-4809- Rodrigue: 4810-4823?- Judith: 4824?-4845- Monica: 4846-4852- Tomas: 4853-4880- Fleche: 4881-4899- Ladislava: 4900-4912- ???: 4913 ("I'm so sorry, but I can't let you in, her grace is resting.")- Male monks/soldiers?: 4914-4924- Female knight?: 4925-4928- Female monk?: 4929-4931- Gatekeeper: 4932-5043- Squire: 5044-5047- Male knights?: 5048-5056- Students?: 5057-5087?- Knights of Seiros?: 5088?-5131- ?: 5132-5139- Students?: 5140-5158?- Soldiers?: 5159?-5170- Church of Seiros Monk?: 5171-5180- Students?: 5181-5183- Knight?: 5184-5208- Monk?: 5209-5250?- Knights?: 5251-5295- Another knight?: 5296-5335- Monk?: 5336-5347- Knight?: 5348-5377- Knight?: 5378-5420- ?: 5421-5431... And so on, mostly NPC voice lines seem to follow, but there may be more left to some named characters as well.### MOV_EN.ktsl2stbinMovie related audio. (The movie files themselves have no audio, only video.)### NR_EN.ktsl2stbinNarrator Recordings, i.e. the narrator's text voice lines. (Related to: `nx\event\narration\text`)### SC_EN.ktsl2stbinThese seem to be battle-related (scenario) voice lines only. (Related to: `nx\event\talk_scinario\text`)- Edelgard: 1-208- Dimitri: 209-431- Claude: 432-701- Hubert: 702-806- Ferdinand: 807-843?- Linhardt: 844?-860- Caspar: 861-887- Bernadetta: 888-906- Dorothea: 907-932- Petra: 933-967- Dedue: 968-1020- Felix: 1021-1055- Ashe: 1056-1083- Sylvain: 1084-1138- Mercedes: 1139-1171- Annette: 1172-1201- Ingrid: 1202-1230- Lorenz: 1231-1265- Raphael: 1266-1280- Ignatz: 1281-1300- Lysithea: 1301-1324?- Marianne: 1325?-1342?- Hilda: 1343?-1376?- Leonie: 1377?-1402- Seteth: 1403-1526- Flayn: 1527-1554- Hanneman: 1555-1568- Manuela: 1569-1585- Gilbert: 1586-1657- Alois: 1658-1679- Catherine: 1680-1720- Shamir: 1721-1738- Cyril: 1739-1748- Jeralt: 1749-1786- Rhea: 1787-1839- Sothis: 1840-1848- Kronya: 1849-1861- Solon: 1862-1880- ...: 1881-1898- 1899-...This is not finished yet...### SE_EN.ktsl2stbinSupport Event voice lines. This is where you should find all the support voice lines between various characters (the ones with rapport).- Edelgard: 1-548- Dimitri: 549-1196- Claude: 1197-1909- Hubert: 1910-2369- Ferdinand: 2370-3066?- Linhardt: 3067?-3746- Caspar: 3747-4384- Bernadetta: 4385-5047- Dorothea: 5048-5492?- Petra: 5493?-6291- Dedue: 6292-6745- Felix: 6746-7343- Ashe: 7344-8012- Sylvain: 8013-8658- Mercedes: 8659-9357- Annette: 9358-10093- Ingrid: 10094-10784- Lorenz: 10785-11437- Raphael: 11438-12047- Ignatz: 12048-12672- Lysithea: 12673-13352- Marianne: 13353-13908- Hilda: 13909-14605- Leonie: 14606-15228- Seteth: 15229-15778- Flayn: 15779-16369- Hanneman: 16370-16880- Manuela: 16881-17411- Gilbert: 17412-17735- Alois: 17736-18198- Catherine: 18199-18804- Shamir: 18805-19354- Cyril: 19355-19798- Rhea: 19799-19906- Sothis: 19907-19950- Anna (Merchant): 19951-19962- Various NPCs, animal sounds, etc.: 19963-20073### SV_EN.ktsl2stbinSupport-related voice lines, such as cooking, tea time, class time, as well as level up lines, defeats, filler words (such as greetings, hey, or the like)... basically for activities that involve spending time together. This is diverse, and seems to be divided into various sections, not characters.### TR_EN.ktsl2stbinTutorial Recordings, i.e. voice lines for introductory mechanics of the game.- Edelgard: 1-64- Dimitri: 65-128- Claude: 129-192- Rhea: 193-195- Sothis: 196-215